<html>
    <head>
        <title>Piano Room Status</title>
		<script type="text/javascript">
			var forceMobile = {{ forceMobile }};
			
			var isMobile = forceMobile || navigator.userAgent.toLowerCase().match(/mobile/i);
			
			// Get HTML head element 
			var head = document.getElementsByTagName('head')[0];  
	  
			// Create new link Element 
			var link = document.createElement('link'); 
	  
			// set the attributes for link element  
			link.rel = 'stylesheet';  
		  
			link.type = 'text/css';

			if(isMobile) {
				link.href = "styles/mobile.css";
			} else {
				link.href = "styles/desktop.css";
			}
	  
			// Append link element to HTML head 
			head.appendChild(link);
		</script>
		<style type="text/css">
		.tg  {border-collapse:collapse;border-spacing:0;}
		.tg .tg-oe15{background-color:#ffffff;border-color:#ffffff;text-align:left;vertical-align:top}
		.tg .tg-zv4m{border-color:#ffffff;text-align:left;vertical-align:top}
		.tg .tg-usta{background-color:#12a8da;border-color:#ffffff;text-align:left;vertical-align:top}
		.tg .tg-v9lk{background-color:#012169;border-color:inherit;color:#ffffff;text-align:left;vertical-align:top}
		.tg .tg-vub4{background-color:#012169;border-color:#ffffff;color:#ffffff;text-align:left;vertical-align:top}
		
		body {
			margin-top: 0px;
			margin-left: 0px;
			margin-right: 0px;
		}
		
		#header h1 {
			background-color: #012169;
			color: #ffffff;
			padding-left: 10px;
			padding-top: 20px;
			padding-bottom: 30px;
		}
		
		#content {
			margin: 5px;
		}
		
		/* Style the tab */
		.tab {
			display: inline-block;
			overflow: hidden;
			border: 1px solid #ccc;
			background-color: #012169;
			color:white;
		}

		/* Style the buttons that are used to open the tab content */
		.tab button {
			background-color: inherit;
			color: inherit;
			float: left;
			border: none;
			outline: none;
			cursor: pointer;
			padding: 14px 16px;
			transition: 0.3s;
		}

		/* Change background color of buttons on hover */
		.tab button:hover {
			background-color: #12a8da;
		}

		/* Create an active/current tablink class */
		.tab button.active {
			background-color: white;
			color: black;
		}

		/* Style the tab content */
		.chart-container {
			display: none;
			border: 1px solid #ccc;
			border-top: none;
			position: relative;
		}
		</style>
		<script type="text/javascript" src="scripts/Chart.js"></script>
		<script type="text/javascript" src="scripts/Chart.min.js"></script>
    </head>
    <body>
		<div id="header">
			<h1>Duke Piano Rooms</h1>
		</div>
		<div id="content">
			<!-- Table generated on https://www.tablesgenerator.com/html_tables -->
			<table class="tg">
				<thead>
				  <tr>
					<th class="tg-v9lk">Room No.</th>
					<th class="tg-v9lk">Availability</th>
					<th class="tg-v9lk">Time Since Use</th>
					<th class="tg-v9lk">Jam Session <img src="images/question_mark.png" title="This column indicates whether a person is open to play music with others" onclick="alert('This column indicates whether a person is open to play music with others')" /></th>
				  </tr>
				</thead>
				<tbody>
				  <tr>
					<td class="tg-vub4">1</td>
					<td class="tg-zv4m" id="roomc1">{{ room1 }}</td>
					<td class="tg-zv4m" id="time1">{{ time1 }}</td>
					<td class="tg-zv4m"><img src="images/jamnote.png" id="jamRoom1" alt="Image" style="display:none"><br></td>
				  </tr>
				  <tr>
					<td class="tg-vub4">2</td>
					<td class="tg-usta" id="roomc2">{{ room2 }}</td>
					<td class="tg-usta" id="time2">{{ time2 }}</td>
					<td class="tg-usta"><img src="images/jamnote.png" id="jamRoom2" alt="Image" style="display:none"><br></td>
				  </tr>
				  <tr>
					<td class="tg-vub4">3</td>
					<td class="tg-zv4m" id="roomc3">{{ room3 }}</td>
					<td class="tg-zv4m" id="time3">{{ time3 }}</td>
					<td class="tg-zv4m"><img src="images/jamnote.png" id="jamRoom3" alt="Image" style="display:none"><br></td>
				  </tr>
				  <tr>
					<td class="tg-vub4">4</td>
					<td class="tg-usta" id="roomc4">{{ room4 }}</td>
					<td class="tg-usta" id="time4">{{ time4 }}</td>
					<td class="tg-usta"><img src="images/jamnote.png" id="jamRoom4" alt="Image" style="display:none"><br></td>
				  </tr>
				</tbody>
			</table>
			
			<br /><br />
			<div class="tab">
				<button class="tablinks active" onclick="openChart(event, 0)">Mon</button>
				<button class="tablinks" onclick="openChart(event, 1)">Tue</button>
				<button class="tablinks" onclick="openChart(event, 2)">Wed</button>
				<button class="tablinks" onclick="openChart(event, 3)">Thu</button>
				<button class="tablinks" onclick="openChart(event, 4)">Fri</button>
				<button class="tablinks" onclick="openChart(event, 5)">Sat</button>
				<button class="tablinks" onclick="openChart(event, 6)">Sun</button>
			</div>
			<div id="chart-container0" class="chart-container" style="display:block">
				<canvas id="myChart0"></canvas>
			</div>
			<div id="chart-container1" class="chart-container">
				<canvas id="myChart1"></canvas>
			</div>
			<div id="chart-container2" class="chart-container">
				<canvas id="myChart2"></canvas>
			</div>
			<div id="chart-container3" class="chart-container">
				<canvas id="myChart3"></canvas>
			</div>
			<div id="chart-container4" class="chart-container">
				<canvas id="myChart4"></canvas>
			</div>
			<div id="chart-container5" class="chart-container">
				<canvas id="myChart5"></canvas>
			</div>
			<div id="chart-container6" class="chart-container">
				<canvas id="myChart6"></canvas>
			</div>
			
			<br />
			<br />
			<form action="/result" method="POST">
				<label for="emails">Write Email to recieve alert
					on room openings:</label><br>
				<input type="email" id="emails" name="emails"
					   value={{request.form.email}}><br>
				<button type=”submit”> Submit </button>

			</form>
		</div>
		<script>
			var data = {{ chartData }};
			for(var i = 0; i < 7; i++) {
				var ctx = document.getElementById('myChart' + i).getContext('2d');
				if(isMobile) {
					Chart.defaults.global.defaultFontSize = document.documentElement.clientWidth * .035;
				}
				var myChart = new Chart(ctx, {
					type: 'bar',
					data: {
						labels: ['12am', '2am', '4am', '6am', '8am', '10am', '12pm', '2pm', '4pm', '6pm', '8pm', '10pm'],
						datasets: [{
							label: 'Room Occupancy',
							data: data[i],
							backgroundColor: [
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da'
							],
							borderColor: [
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da',
								'#12a8da'
							],
							borderWidth: 1
						}]
					},
					options: {
						tooltips: false,
						scales: {
							yAxes: [{
								scaleLabel: {
									display: true,
									labelString: 'Percent Use'
								},
								ticks: {
									beginAtZero: true,
									max: 100,
									display: true,
									stepSize: 20,
									callback: function(value, index, values) {
										return value + "%";
									}
								}
							}]
						}
					}
				});
			}
			
			function openChart(evt, chartId) {
				var i, tabcontent, tablinks;
				tabcontent = document.getElementsByClassName("chart-container");
				for (i = 0; i < tabcontent.length; i++) {
					tabcontent[i].style.display = "none";
				}
				tablinks = document.getElementsByClassName("tablinks");
				for (i = 0; i < tablinks.length; i++) {
					tablinks[i].className = tablinks[i].className.replace(" active", "");
				}
				document.getElementById("chart-container"+chartId).style.display = "block";
				evt.currentTarget.className += " active";
			}
		</script>

		<script type="text/javascript">
			function jamImgDisp(jamRoomCond) {
				if (jamRoomCond == 1) {
					return 'inline'
				} else if (jamRoomCond == 0) {
					return 'none'
				}
			}
			
			function updateJam(jam1, jam2, jam3, jam4) {
				document.getElementById("jamRoom1").style.display = jamImgDisp(jam1);
				document.getElementById("jamRoom2").style.display = jamImgDisp(jam2);
				document.getElementById("jamRoom3").style.display = jamImgDisp(jam3);
				document.getElementById("jamRoom4").style.display = jamImgDisp(jam4);
			}
			
			updateJam({{ jamStat1 }}, {{ jamStat2 }}, {{ jamStat3 }}, {{ jamStat4 }});
			
			var source = new EventSource("/listen");
			source.onmessage = function(event) {
				msg = JSON.parse(event.data.replaceAll("\'", "\""));
								
				document.getElementById("roomc1").innerHTML = msg.room1;
				document.getElementById("roomc2").innerHTML = msg.room2;
				document.getElementById("roomc3").innerHTML = msg.room3;
				document.getElementById("roomc4").innerHTML = msg.room4;
				
				document.getElementById("time1").innerHTML = msg.time1;
				document.getElementById("time2").innerHTML = msg.time2;
				document.getElementById("time3").innerHTML = msg.time3;
				document.getElementById("time4").innerHTML = msg.time4;
				
				updateJam(msg.jam1, msg.jam2, msg.jam3, msg.jam4);
			};
		</script>
    </body>
</html>